<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„äº‘ç«¯å¾…åŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body class="bg-gray-100">
    <div id="app" class="max-w-md mx-auto mt-6 p-6 bg-white rounded-xl shadow-lg">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">ğŸ“… æ·»åŠ æé†’</h1>

        <div v-if="!savedToken" class="space-y-4">
            <div class="bg-yellow-50 p-4 rounded border border-yellow-200 text-sm text-yellow-800">
                åˆæ¬¡ä½¿ç”¨éœ€é…ç½® Token (ä»…ä¿å­˜åœ¨æœ¬åœ°)
            </div>
            <input type="password" v-model="tokenInput" class="w-full p-3 border rounded focus:ring-2 focus:ring-green-500 outline-none" placeholder="ç²˜è´´ ghp_ å¼€å¤´çš„ Token">
            <button @click="saveToken" class="w-full bg-green-600 text-white p-3 rounded font-bold">ä¿å­˜é…ç½®</button>
        </div>

        <div v-else class="space-y-5">
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">å¾…åŠäº‹é¡¹</label>
                <input type="text" v-model="title" class="w-full p-3 border rounded focus:ring-2 focus:ring-green-500 outline-none" placeholder="ä¾‹å¦‚ï¼šå»åŒ»é™¢å¤æŸ¥">
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">æé†’æ—¶é—´</label>
                <input type="datetime-local" v-model="date" class="w-full p-3 border rounded focus:ring-2 focus:ring-green-500 outline-none">
            </div>

            <div class="bg-blue-50 p-3 rounded border border-blue-100 flex items-center justify-between">
                <span class="text-sm text-blue-800">ğŸ”” å¼€å¯é˜²å¿˜æé†’ (æå‰1å¤©)</span>
                <input type="checkbox" v-model="autoRemind" class="w-5 h-5 text-green-600">
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">å¤‡æ³¨ (é€‰å¡«)</label>
                <textarea v-model="body" rows="2" class="w-full p-3 border rounded focus:ring-2 focus:ring-green-500 outline-none"></textarea>
            </div>

            <button @click="submitIssue" :disabled="loading" class="w-full bg-green-600 text-white p-3 rounded font-bold hover:bg-green-700 transition disabled:bg-gray-400">
                {{ loading ? 'æäº¤ä¸­...' : 'æ·»åŠ ä»»åŠ¡' }}
            </button>
            <div class="text-center">
                <button @click="clearToken" class="text-xs text-gray-400 underline">é‡ç½® Token</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    // ğŸ‘‡ å·²ä¿®æ”¹ä¸ºä½ æä¾›çš„ç”¨æˆ·å ğŸ‘‡
                    repoOwner: 'XXXie-1',
                    // ğŸ‘‡ è¯·ç¡®è®¤ä½ çš„ä»“åº“åæ˜¯å¦ä¹Ÿæ˜¯ 'todo-list'ï¼Œå¦‚æœä¸æ˜¯è¯·ä¿®æ”¹è¿™é‡Œ ğŸ‘‡
                    repoName: 'todo-list', 
                    
                    tokenInput: '', 
                    savedToken: localStorage.getItem('gh_todo_token') || '',
                    title: '', 
                    date: '', 
                    body: '', 
                    autoRemind: true, 
                    loading: false
                }
            },
            mounted() {
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset() + 60);
                this.date = now.toISOString().slice(0, 16);
            },
            methods: {
                saveToken() { 
                    if(this.tokenInput.startsWith('ghp_')) {
                        localStorage.setItem('gh_todo_token', this.tokenInput);
                        this.savedToken = this.tokenInput;
                    } else alert('Token æ ¼å¼ä¸å¯¹');
                },
                clearToken() { localStorage.removeItem('gh_todo_token'); this.savedToken = ''; },
                async submitIssue() {
                    if (!this.title || !this.date) return alert('è¯·å¡«å†™å®Œæ•´');
                    this.loading = true;
                    try {
                        const labels = this.autoRemind ? ['æå‰1å¤©'] : [];
                        const finalTitle = `${this.title} [${this.date.replace('T', ' ')}]`;
                        const res = await fetch(`https://api.github.com/repos/${this.repoOwner}/${this.repoName}/issues`, {
                            method: 'POST',
                            headers: { 'Authorization': `token ${this.savedToken}`, 'Content-Type': 'application/json' },
                            body: JSON.stringify({ title: finalTitle, body: this.body, labels: labels })
                        });
                        if (res.ok) { alert('âœ… æ·»åŠ æˆåŠŸï¼'); this.title = ''; this.body = ''; }
                        else { 
                            const err = await res.json();
                            alert('âŒ å¤±è´¥ï¼š' + (err.message || 'è¯·æ£€æŸ¥Tokenæƒé™æˆ–ä»“åº“å')); 
                        }
                    } catch (e) { alert('ç½‘ç»œé”™è¯¯'); } 
                    finally { this.loading = false; }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
